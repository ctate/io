# About HTTPS

HTTPS is more complex than simply being "enabled" or not.

**Tip:** If you're in a hurry, proceed to the next sections for step-by-step instructions on setting everything up using different techniques.

To learn the basics of HTTPS from a consumer perspective, check howhttps.works.

From a developer's perspective, consider the following:

- For HTTPS, the server must have certificates generated by a third party.
  - Certificates are acquired from the third party, not generated.
- Certificates have a lifetime; they expire and need to be renewed.
- Encryption occurs at the TCP level, which is below HTTP.
  - Certificate and encryption handling happens before HTTP.
- TCP only recognizes IP addresses, not domains.
  - Domain information is included in the HTTP data.
- HTTPS certificates certify a specific domain, but encryption occurs at the TCP level before the domain is known.
- By default, only one HTTPS certificate can exist per IP address, regardless of server size or application count.
  - There is a solution: the SNI extension to the TLS protocol.
- SNI allows a single server with one IP address to have multiple HTTPS certificates and serve multiple domains/applications.
  - A single component must manage all HTTPS certificates on the server.
- After establishing a secure connection, the communication protocol remains HTTP.
  - Contents are encrypted, but sent using the HTTP protocol.

Typically, one program (the TLS Termination Proxy) manages all HTTPS aspects: receiving encrypted HTTPS requests, sending decrypted HTTP requests to the application (e.g., FastAPI), and encrypting HTTP responses before sending them back to the client.

**Options for TLS Termination Proxy:**
- Traefik (handles certificate renewals)
- Caddy (handles certificate renewals)
- Nginx
- HAProxy

## Let's Encrypt

Before Let's Encrypt, HTTPS certificates were sold by trusted third parties, requiring cumbersome processes and significant costs. Let's Encrypt, a project from the Linux Foundation, provides free HTTPS certificates in an automated manner. These certificates use standard cryptographic security and are short-lived (about 3 months), enhancing security through their reduced lifespan. Domains are securely verified, and certificate renewal is automated, allowing for secure HTTPS indefinitely.

## HTTPS for Developers

### Domain Name

Start by acquiring a domain name and configuring it in a DNS server. Obtain a cloud server with a fixed public IP address. Configure an "A record" in the DNS server to point your domain to the server's public IP address.

**Tip:** This domain name setup occurs before HTTPS, but it's essential as everything depends on the domain and IP address.

### DNS

The browser checks DNS servers for the IP of the domain (e.g., someapp.example.com). The DNS servers provide the public IP address of your server.

### TLS Handshake Start

The browser communicates with the IP address on port 443 (the HTTPS port) to establish a connection and decide on cryptographic keys.

This interaction is called the TLS handshake.

### TLS with SNI Extension

Only one process can listen on a specific port for a specific IP address. The TLS Termination Proxy listens on port 443 and accesses one or more TLS certificates. Using the SNI extension, it determines which TLS certificate to use based on the domain expected by the client (e.g., someapp.example.com).

The client verifies the certificate's validity and, using it, the client and TLS Termination Proxy agree on encryption for the TCP communication, completing the TLS handshake.

### HTTPS Request

With an encrypted TCP connection established, the client sends an HTTPS request, which is an HTTP request over an encrypted TLS connection.

### Decrypt the Request

The TLS Termination Proxy decrypts the request and transmits the plain HTTP request to the application (e.g., Uvicorn running FastAPI).

### HTTP Response

The application processes the request and sends a plain HTTP response to the TLS Termination Proxy.

### HTTPS Response

The TLS Termination Proxy encrypts the response using the agreed cryptography and sends it back to the browser. The browser verifies the response's validity and decrypts it for processing.

### Multiple Applications

Multiple applications can run on the same server, as long as they do not use the same combination of public IP and port. The TLS Termination Proxy can handle HTTPS and certificates for multiple domains and applications.

### Certificate Renewal

Certificates expire approximately 3 months after acquisition. A renewal program must prove domain ownership to Let's Encrypt. Popular renewal methods include:

- Modifying DNS records (requires DNS provider API support).
- Running a server on the public IP during the renewal process.

Having a separate system to handle HTTPS with a TLS Termination Proxy is beneficial for managing certificate renewals without downtime.

## Recap

Having HTTPS is critical. Most developer effort involves understanding these concepts. Once familiar, you can combine and configure tools to manage HTTPS effectively. Future chapters will provide concrete examples of setting up HTTPS for FastAPI applications.